---
import { AssistantWidget } from '~/components/assistant-widget'
import { getLocalePath, getTranslationForLocale } from '~/i18n/ui'
import GalleryCarousel from '~/components/gallery-carousel'
import { Header } from '~/components/header'
import { StepsTimeline } from '~/components/steps-timeline'

interface Props {
	locale: string
}

const { locale } = Astro.props
const ui = getTranslationForLocale(locale ?? 'en')
const localePath = getLocalePath(locale ?? 'en')
---

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CYO Design</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=GFS+Didot&display=swap" rel="stylesheet">
	<style>
	.font-didot { font-family: 'GFS Didot', serif; }
	html { scroll-behavior: smooth; }
	</style>
</head>

<body class="bg-white text-gray-900">
	{/* HERO SECTION WITH VIDEO BG */}
	<section class="relative h-[100vh] flex flex-col overflow-hidden">
		<!-- <div class="absolute inset-0 w-full h-full object-cover bg-primary-dark" /> -->
		<video preload="auto" class="absolute inset-0 w-full h-full object-cover" autoplay loop muted playsinline>
			<source src="https://storage.googleapis.com/cyodesign/assets/hero/hero-v2.mp4" type="video/mp4" />
		</video>
		{/* Overlay for readability */}
		<!-- <div class="absolute inset-0 bg-emerald-900/40"></div> -->

		{/* Navigation/Header */}
		<Header locale={locale} client:load />

		{/* Hero Content */}
		<div class="flex-1 flex flex-col justify-end items-center relative z-20 px-8 pb-16">
			<div class="text-center">
				<h2 class="text-2xl lg:text-5xl font-didot text-white mb-4 drop-shadow-lg">
					{ui['hero.title']}
				</h2>
				<h3 class="lg:block font-didot text-white text-sm md:text-lg mt-4 drop-shadow">
					{ui['hero.subtitle']}
				</h3>
				<a
					href="#assistant"
					class="mt-8 inline-block bg-primary text-white px-6 py-3 rounded-full font-semibold text-lg shadow-lg hover:bg-primary-dark transition-colors duration-300"
				>
					ðŸ’Ž {ui['hero.callToAction']}
				</a>
			</div>
			<a href="#gallery" class="animate-bounce mt-8 hidden md:flex flex-col items-center text-white">
				<svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path d="M19 9l-7 7-7-7" />
				</svg>
				<span class="text-sm mt-1">{ui['hero.scrollToGallery']}</span>
			</a>
		</div>
	</section>

	{/* AI Assistant Section */}
	<section id="assistant" class="w-full py-16 bg-primary-dark">
		<div class="w-[95%] h-[600px] flex justify-center items-center mx-auto">
			<AssistantWidget client:load locale={locale ?? 'en'} />
		</div>
	</section>

	{/* GALLERY / INSPIRATIONS */}
	<section id="gallery" class="w-full mb-24">
		<div class="max-w-7xl mx-auto">
			<h2 class="text-4xl font-didot text-center mb-8 pt-12">{ui['gallery.title']}</h2>
			<GalleryCarousel client:only />
		</div>
	</section>

	<section>
		<div class="w-full">
			<img
				src="https://storage.googleapis.com/cyodesign/assets/diamond-brooch.jpg"
				alt="Diamond Brooch"
				class="w-full h-auto object-cover"
			/>
			<img
				src="https://storage.googleapis.com/cyodesign/assets/gold-snake-emerald-eye.jpg"
				alt="Emerald Eye on a Gold Snake"
				class="w-full h-auto object-cover"
			/>
		</div>
	</section>

	{/* GDPR LEAD COLLECTION */}
	<section class="py-10 px-6 bg-gray-50 border-t border-b border-gray-200 w-full z-30 relative">
		<div class="max-w-lg mx-auto text-center">
			<h2 class="font-didot text-2xl mb-4">{ui['lead.title']}</h2>
			<p class="font-didot mb-6 text-gray-700">{ui['lead.description']}</p>
			<form id="subscribe-form" method="POST" action="/api/subscribe" class="space-y-4">
				<input
					type="email"
					name="email"
					required
					placeholder={ui['lead.emailPlaceholder']}
					class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring"
				/>
				<div class="flex items-center justify-center space-x-2 text-left">
					<input type="checkbox" id="gdpr-consent" name="gdpr-consent" required class="accent-emerald-700" />
					<label for="gdpr-consent" class="text-sm text-gray-600" set:html={ui['lead.gdprLabel']}></label>
				</div>
				<button
					id="subscribe-btn"
					type="submit"
					class="w-full px-4 py-2 bg-primary text-white rounded transition flex items-center justify-center gap-2"
				>
					<span id="subscribe-btn-text">{ui['lead.button']}</span>
					<svg id="subscribe-spinner" class="w-5 h-5 animate-spin hidden" fill="none" viewBox="0 0 24 24">
						<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
						<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
					</svg>
				</button>
				<div id="subscribe-feedback" class="text-sm mt-2"></div>
			</form>
		</div>
	</section>

	{/* ABOUT US SECTION (56vw to conform to the video aspect ratio 9/16 = 0.5625) */}
	<section id="about" class="relative w-full h-auto md:h-[56vw] grid place-items-center px-8 py-18 overflow-hidden">
		{/* Background Video */}
		<video
			preload="auto"
			poster="https://storage.googleapis.com/cyodesign/assets/aboutus-necklace.jpg"
			class="absolute inset-0 w-full h-full object-cover"
			autoplay
			loop
			muted
			playsinline
		>
			<source src="https://storage.googleapis.com/cyodesign/assets/aboutus-necklace.mp4" type="video/mp4" />
		</video>
		{/* Overlay for readability */}
		<div class="absolute inset-0 bg-black/50"></div>
		{/* Content */}
		<div class="relative z-10 max-w-4xl mx-auto text-center">
			<h2 class="font-didot text-4xl mb-12 text-white drop-shadow-lg">{ui['aboutus.title']}</h2>
			<p class="text-white text-lg md:text-xl leading-relaxed max-w-3xl mx-auto whitespace-pre-line drop-shadow">
				{ui['aboutus.subtitle']}
			</p>
		</div>
	</section>

	{/* FOUR STEPS TIMELINE SECTION */}
	<section class="py-16 w-full">
		<StepsTimeline locale={locale} client:load />
	</section>

	{/* FOOTER */}
	<footer class="bg-primary-dark text-gray-100 py-8 mt-16">
		<div class="flex flex-row justify-around items-center align-middle px-6">
			<div class="flex items-center align-middle gap-4 md:mb-0">
				<a href={locale === 'de' ? '/de' : '/'} class="font-didot text-xl text-white">CYO Design</a>
				<span class="text-gray-500">Â© {new Date().getFullYear()}</span>
			</div>
			<div class="flex items-center space-x-4">
				<a href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Instagram">
					<svg class="w-6 h-6 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
						<path
							d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5A4.25 4.25 0 0 0 20.5 16.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5zm4.25 3.25a5.25 5.25 0 1 1 0 10.5 5.25 5.25 0 0 1 0-10.5zm0 1.5a3.75 3.75 0 1 0 0 7.5 3.75 3.75 0 0 0 0-7.5zm5.25.75a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"
						/>
					</svg>
				</a>
				<a href="https://facebook.com/" target="_blank" rel="noopener" aria-label="Facebook">
					<svg class="w-6 h-6 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
						<path
							d="M22 12c0-5.522-4.477-10-10-10S2 6.478 2 12c0 5 3.657 9.127 8.438 9.877v-6.987h-2.54v-2.89h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.242 0-1.632.771-1.632 1.562v1.875h2.773l-.443 2.89h-2.33v6.987C18.343 21.127 22 17 22 12"
						/>
					</svg>
				</a>
				<a href="https://x.com/" target="_blank" rel="noopener" aria-label="X">
					<svg class="w-6 h-6 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
						<path
							d="M17.53 3H21l-7.19 8.19L22 21h-6.56l-5.19-6.19L3 21H0l7.81-8.89L2 3h6.56l4.81 5.74L17.53 3zm-2.13 16h2.13l-5.19-6.19L5.47 19h2.13l3.19-3.81L15.4 19z"
						/>
					</svg>
				</a>
			</div>
			<!-- <div class="flex items-center space-x-6 mb-4 md:mb-0">
				<a href={localePath('/impressum')} class="text-gray-300">{ui['footer.impressum']}</a>
				<a href={localePath('/privacy')} class="text-gray-300">{ui['footer.privacy']}</a>
				<a href={localePath('/about')} class="text-gray-300">{ui['nav.about']}</a>
			</div> -->
		</div>
	</footer>
</body>
<script type="module">
document.addEventListener('DOMContentLoaded', () => {
	const form = document.getElementById('subscribe-form')
	const feedback = document.getElementById('subscribe-feedback')
	const btn = document.getElementById('subscribe-btn')
	const btnText = document.getElementById('subscribe-btn-text')
	const spinner = document.getElementById('subscribe-spinner')
	if (form) {
		form.addEventListener('submit', async (e) => {
			e.preventDefault()
			feedback.textContent = ''
			btn.disabled = true
			btn.classList.add('opacity-60', 'cursor-not-allowed')
			btnText.textContent = 'Submitting...'
			spinner.classList.remove('hidden')
			const formData = new FormData(form)
			const email = formData.get('email')
			const consent = formData.get('gdpr-consent')
			if (!email || !consent) {
				btn.disabled = false
				btn.classList.remove('opacity-60', 'cursor-not-allowed')
				btnText.textContent = 'Sign Up'
				spinner.classList.add('hidden')
				return
			}
			try {
				const res = await fetch('/api/subscribe', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ email }),
				})
				if (res.ok) {
					feedback.textContent = 'Thank you for signing up!'
					feedback.className = 'text-green-600 mt-2'
					form.reset()
				} else {
					feedback.textContent = 'There was an error. Please try again.'
					feedback.className = 'text-red-600 mt-2'
				}
			} catch {
				feedback.textContent = 'There was an error. Please try again.'
				feedback.className = 'text-red-600 mt-2'
			}
			btn.disabled = false
			btn.classList.remove('opacity-60', 'cursor-not-allowed')
			btnText.textContent = 'Sign Up'
			spinner.classList.add('hidden')
		})
	}
})
</script>
